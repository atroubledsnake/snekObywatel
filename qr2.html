<body>
  <div class="top_grid">
    <div class="action_grid" style="width: 25%;">
      <img src="images/BDZT6fX.png" class="back_img">
      <p onclick="sendTo('card')" class="back_text" style="margin-left: 7px;">mDowód</p>
    </div>
    <p class="title_text" style="text-align: center;">Zeskanuj kod QR</p>
  </div>

  <div class="bottom_bar">
    <div class="bottom_bar_grid">
      <div class="bottom_element_grid" send="home">
        <div class="bottom_element_image home_open"></div>
        <p class="bottom_element_text">Pulpit</p>
      </div>
      <div class="bottom_element_grid" send="documents">
        <div class="bottom_element_image documents"></div>
        <p class="bottom_element_text open">Dokumenty</p>
      </div>
      <div class="bottom_element_grid" send="services">
        <div class="bottom_element_image services"></div>
        <p class="bottom_element_text">Usługi</p>
      </div>
      <div class="bottom_element_grid" send="qr">
        <div class="bottom_element_image qr"></div>
        <p class="bottom_element_text">Kod QR</p>
      </div>
      <div class="bottom_element_grid" send="more">
        <div class="bottom_element_image more"></div>
        <p class="bottom_element_text">Więcej</p>
      </div>
    </div>
  </div>

  <!-- QR camera view -->
  <div id="qr-reader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;"></div>

  <!-- Ramka skanowania -->
  <div class="qr-overlay" style="
      position: fixed;
      top: 50%;
      left: 50%;
      width: 220px;
      height: 220px;
      transform: translate(-50%, -50%);
      pointer-events: none;
    ">
    <div style="
        position: absolute;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        border: 4px solid white;
        border-radius: 16px;
        opacity: 0.8;
      ">
    </div>
  </div>

  <div class="alert-info" style="
      position: absolute;
      top: 80px;
      left: 16px;
      right: 16px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 10;
    ">
    <span style="font-size: 1.2rem;">⚠️</span> Upewnij się, że kod QR pochodzi z wiarygodnego źródła.
  </div>

  <button class="code-button" onclick="manualEntry()">Wpisz kod</button>

  <script>
    const onScanSuccess = (decodedText) => {
      alert("✅ Zeskanowano: " + decodedText);
    };

    const onScanError = (errorMessage) => {
      // Można pominąć logowanie
    };

    const html5QrCode = new Html5Qrcode("qr-reader");

    Html5Qrcode.getCameras().then(devices => {
      html5QrCode.start(
        { facingMode: "environment" },
        {
          fps: 10,
          qrbox: { width: 220, height: 220 }
        },
        onScanSuccess,
        onScanError
      );
    }).catch(err => {
      console.error("🚫 Błąd kamery:", err);
      alert("Nie udało się uzyskać dostępu do kamery.");
    });

    function manualEntry() {
      const code = prompt("Wpisz kod ręcznie:");
      if (code) {
        alert("Wprowadzony kod: " + code);
      }
    }
  </script>

  <script src="assets/bar.js"></script>
  <script src="assets/manifest.js"></script>
</body>
